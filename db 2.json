{"meta":{"version":1,"warehouse":"4.0.1"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"node_modules/hexo-theme-landscape/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.css","path":"fancybox/jquery.fancybox.min.css","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.js","path":"fancybox/jquery.fancybox.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/js/jquery-3.4.1.min.js","path":"js/jquery-3.4.1.min.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/js/script.js","path":"js/script.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.woff2","path":"css/fonts/fontawesome-webfont.woff2","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-landscape/source/css/images/icon.png","path":"css/images/icon.png","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"661e9386514bf8da5854b578e9b101dcb25432af","modified":1650895884480},{"_id":"source/CNAME","hash":"7e87bd85e7c1da7e3ec32560db884aa53d6d5da2","modified":1650881876891},{"_id":"source/_posts/.DS_Store","hash":"18b79c3f3881356e50a861177d389f11a1ebee8e","modified":1650894881201},{"_id":"source/_posts/hello-world.md","hash":"99d0ab98ef3fd23b22e0c91ec933ff0ade5f538f","modified":1650801407623},{"_id":"source/_posts/android-签名方案研究.md","hash":"279cb81d14263c5ebbd20e6ad2f7c0aebf15f3e3","modified":1650790480876},{"_id":"source/_posts/我的铃铛.md","hash":"aef822419bc4fa4b01b180c2cf8a7f510873c04c","modified":1650790558751},{"_id":"source/_posts/我的虎妞.md","hash":"db7f97c6c909c07cda9373ec66ebc44c013dc393","modified":1650790406044},{"_id":"node_modules/hexo-theme-landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/README.md","hash":"d2772ece6d4422ccdaa0359c3e07588834044052","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/_config.yml","hash":"e086c1aaa0c7fa5193979a91afdddbed796f9ac8","modified":1650891603021},{"_id":"node_modules/hexo-theme-landscape/package.json","hash":"bdfe9c08625f92f2016d7b9982e5cd7306114018","modified":1650694281082},{"_id":"node_modules/hexo-theme-landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/en.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/hu.yml","hash":"284d557130bf54a74e7dcef9d42096130e4d9550","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/it.yml","hash":"89b7d91306b2c1a0f3ac023b657bf974f798a1e8","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/mn.yml","hash":"2e7523951072a9403ead3840ad823edd1084c116","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/tr.yml","hash":"a1cdbfa17682d7a971de8ab8588bf57c74224b5b","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/zh-CN.yml","hash":"1efd95774f401c80193eac6ee3f1794bfe93dc5a","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/layout.ejs","hash":"0d1765036e4874500e68256fedb7470e96eeb6ee","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/scripts/fancybox.js","hash":"c857d7a5e4a5d71c743a009c5932bf84229db428","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/.DS_Store","hash":"3037d5331d92d3f549f33102664cadfff9459707","modified":1650851580817},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/after-footer.ejs","hash":"414914ebb159fac1922b056b905e570ac7521925","modified":1650850688823},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/archive.ejs","hash":"7cb70a7a54f8c7ae49b10d1f37c0a9b74eab8826","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/article.ejs","hash":"dfd555c00e85ffc4207c88968d12b219c1f086ec","modified":1650849856131},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/footer.ejs","hash":"3656eb692254346671abc03cb3ba1459829e0dce","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/gauges-analytics.ejs","hash":"21a1e2a3907d1a3dad1cd0ab855fe6735f233c74","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/google-analytics.ejs","hash":"2ea7442ea1e1a8ab4e41e26c563f58413b59a3d0","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/head.ejs","hash":"f215d92a882247a7cc5ea80b241bedfcec0ea6ca","modified":1650889390357},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/header.ejs","hash":"c1acd247e14588cdf101a69460cb8319c18cd078","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/recent_posts.ejs","hash":"60c4b012dcc656438ff59997e60367e5a21ab746","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/.DS_Store","hash":"5a7cbaf276b7f5fda92425c1ee16005c1b1ca1c6","modified":1650851583553},{"_id":"node_modules/hexo-theme-landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_variables.styl","hash":"5ae4016180660aeac5ee22be3b38592723101d58","modified":1650890146555},{"_id":"node_modules/hexo-theme-landscape/source/css/style.styl","hash":"9c451e5efd72c5bb8b56e8c2b94be731e99db05b","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/js/script.js","hash":"ee711b326ef6ab841b331b8bd3bbaeb66ce18192","modified":1650886125749},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/date.ejs","hash":"f1458584b679545830b75bef2526e2f3eb931045","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/nav.ejs","hash":"57eb85831e029436935e00ad14919141bc7a0ec3","modified":1650886115051},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/layout/_partial/post/title.ejs","hash":"4d7e62574ddf46de9b41605fe3140d77b5ddb26d","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/article.styl","hash":"80759482d07063c091e940f964a1cf6693d3d406","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/header.styl","hash":"85ab11e082f4dd86dde72bed653d57ec5381f30c","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/highlight.styl","hash":"bf4e7be1968dad495b04e83c95eac14c4d0ad7c0","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/images/.DS_Store","hash":"12d65967d1027b183ccb25abaa58c15845454828","modified":1650891304460},{"_id":"node_modules/hexo-theme-landscape/source/css/images/icon.png","hash":"5fafe4a27067acd8f1b7d97120933e89adb6cbd0","modified":1650891255836},{"_id":"node_modules/hexo-theme-landscape/source/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/js/jquery-3.4.1.min.js","hash":"88523924351bac0b5d560fe0c5781e2556e7693d","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":499162500000},{"_id":"node_modules/hexo-theme-landscape/source/css/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":499162500000},{"_id":"public/search.xml","hash":"47bd653f1393e93fe1841e5d4da1a97c70737ea7","modified":1650891794547},{"_id":"public/atom.xml","hash":"354e0e1c44ef9edbac6efcfbb75699a1dbe88138","modified":1650891794547},{"_id":"public/2022/04/23/我的虎妞/index.html","hash":"bcafc8d8c28c04077e18904d35f7042e54732ee4","modified":1650891794547},{"_id":"public/2022/04/23/我的铃铛/index.html","hash":"7a4c57ecd1336278f9ef6ea39f20f5fac67fcd81","modified":1650891794547},{"_id":"public/2022/04/23/hello-world/index.html","hash":"4addcc89d37c2f259ee0d130b003306b29f229fa","modified":1650891794547},{"_id":"public/archives/index.html","hash":"f61b4035ba012a9155223bd86aae7d8d124a8a58","modified":1650891794547},{"_id":"public/archives/2022/index.html","hash":"f7e7cb29848298a014e41b1944cc6109f67b01a6","modified":1650891794547},{"_id":"public/archives/2022/04/index.html","hash":"8c4ccf336410b932226cd10bc9b8dcda88b85a95","modified":1650891794547},{"_id":"public/index.html","hash":"88f87a0d3176b64bb9c7af7b6511c07706bc6a95","modified":1650891794547},{"_id":"public/tags/android/index.html","hash":"7160a77355e2bad37bdfd2b619fd597670ee6a25","modified":1650891794547},{"_id":"public/tags/hexo/index.html","hash":"aaccab3a25651fa3530bc3adab5d46eb0d94bb6f","modified":1650891794547},{"_id":"public/tags/宠物/index.html","hash":"4aefc21ec97aedb70125f984522123a2a4767613","modified":1650891794547},{"_id":"public/2022/04/24/android-签名方案研究/index.html","hash":"78bb372cd2548ee495573fd5ed9faffefa18ccda","modified":1650891794547},{"_id":"public/CNAME","hash":"7e87bd85e7c1da7e3ec32560db884aa53d6d5da2","modified":1650891794547},{"_id":"public/css/images/icon.png","hash":"5fafe4a27067acd8f1b7d97120933e89adb6cbd0","modified":1650891794547},{"_id":"public/css/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1650891794547},{"_id":"public/css/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1650891794547},{"_id":"public/css/fonts/fontawesome-webfont.ttf","hash":"13b1eab65a983c7a73bc7997c479d66943f7c6cb","modified":1650891794547},{"_id":"public/css/fonts/FontAwesome.otf","hash":"048707bc52ac4b6563aaa383bfe8660a0ddc908c","modified":1650891794547},{"_id":"public/css/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1650891794547},{"_id":"public/fancybox/jquery.fancybox.min.css","hash":"1be9b79be02a1cfc5d96c4a5e0feb8f472babd95","modified":1650891794547},{"_id":"public/js/script.js","hash":"ee711b326ef6ab841b331b8bd3bbaeb66ce18192","modified":1650891794547},{"_id":"public/css/style.css","hash":"263d98c93ae32dda6f7bbc8473105f3c441aca99","modified":1650891794547},{"_id":"public/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1650891794547},{"_id":"public/css/fonts/fontawesome-webfont.svg","hash":"98a8aa5cf7d62c2eff5f07ede8d844b874ef06ed","modified":1650891794547},{"_id":"public/fancybox/jquery.fancybox.min.js","hash":"6181412e73966696d08e1e5b1243a572d0f22ba6","modified":1650891794547},{"_id":"public/js/jquery-3.4.1.min.js","hash":"88523924351bac0b5d560fe0c5781e2556e7693d","modified":1650891794547},{"_id":"source/_posts/hexo-博客搭建教程.md","hash":"235b7b39f9d9f2efac53709b550455c25829fab5","modified":1650896793658}],"Category":[{"name":"ss","_id":"cl2es5n0900012n6x8a7vb65d"},{"name":"文章","_id":"cl2esfhit0000kl6xhk8pb0yy"},{"name":"教程","_id":"cl2et50kg0000ml6xhb6qf59q"},{"name":"hexo","_id":"cl2et538v0002ml6xfc4y9pzj"}],"Data":[],"Page":[],"Post":[{"title":"android签名详解","date":"2022-04-24T04:36:49.000Z","_content":"\n**Android 支持以下三种应用签名方案**\n\n- v1 方案：基于 JAR 签名。\n- v2 方案：[APK 签名方案 v2](https://source.android.com/security/apksigning/v2?hl=zh-cn)（在 Android 7.0 中引入），Android 11 强制要求开启 v2 签名。\n- v3 方案：[APK 签名方案 v3](https://source.android.com/security/apksigning/v3?hl=zh-cn)（在 Android 9.0 中引入）。\n\n**APK 签名验证过程**\n\n<!-- more -->\n\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637240247957-902343f6-793b-467d-88da-39cb6b79b65b.png)\n\n## v1 签名机制\n\n**v1 签名过程**\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241119998-710e5f21-ceb5-427d-9737-732fc517d842.png)\n\nandroid apk 本质上是一个 zip 文件，解压缩 apk 之后，在 META-INF 文件下下面有个 3 个文件。这 3 个文件在签名时创建，在验证时使用。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241932281-ff71b895-3437-4847-b94e-e1343a28a22b.png)\n\n1. MANIFEST.MF 文件\n\n文件内容：前面几行记录的是基础信息，后面的 key-value 对，记录 apk 中每一个文件对应的摘要信息，防止某个文件被篡改。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241496036-ae9f77f3-de63-498b-84de-c73bd76dbbe5.png)\n\n1. CERT.SF 文件\n\n文件的内容：**SHA-256-Digest-Manifest** 记录的是 **MANIFEST.MF** 的信息摘要，以及 **MANIFEST.MF** 中，每个数据块的摘要。防止 **MANIFEST.MF** 被篡改。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241675582-ba01a2ff-a958-4c1b-a1a8-8ffb83b7e12d.png)\n\n1. CERT.RSA 文件\n\n文件内容：存储了签名和公钥证书以及 SF 文件的摘要信息。\n\n```git\nopenssl pkcs7 -inform DER -in CERT.RSA -noout -print_certs -text\n```\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637289563483-c9d98b18-0e99-4a10-94b8-67a7a89aca25.png)\n\n**v1 签名存在的问题**\n\n1. **校验速度慢：**需要对 apk 中的每个文件都计算摘要并验证，如果文件很多，校验时间会很长。\n2. **完整性不够：**V1 签名只会校验 Zip 文件中的部分文件，例如 **META-INFO** 文件夹就不会参与校验。\n\n## V2 签名机制\n\n了解 zip 压缩包格式和 APK 签名之后的数据格式\n\n为了保护 APK 内容，APK 包含以下 4 个部分：\n\n- ZIP 条目的内容（从偏移量 0 处开始一直到“APK 签名分块”的起始位置）\n- APK 签名分块\n- ZIP 中央目录\n- ZIP 中央目录结尾\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637291796732-139b2e40-e3ee-4fcc-a390-1f522c09d08c.png)\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637291614626-4631c226-7cf7-462c-83f2-231beb6cd268.png)\n\n**zip 压缩包的解析过程**\n\n1. 先从文件尾部查找 0x06054b50，确定 End Of Central Directory Record 区域的起始位置；\n2. 解析 EoCDR 区域，并获得中央目录的起始位置；\n3. 根据起始位置，逐个解析文件。\n\n**V2 签名数据块的格式**\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637292066946-cb513fd0-a6d9-4877-97a4-a11f6cc69c5a.png)\n\n该分块包含多个“ID-值”对，所采用的封装方式有助于更轻松地在 APK 中找到该分块。APK 的 v2 签名会存储为一个“ID-值”对，其中 ID 为 0x7109871a 保存 apk 的签名信息。\n\n签名块的末尾是一个魔数，也就是‘APK Sig Block 42’的 ASCII 码。\n\n**签名信息的具体结构**\n\n“APK 签名方案 v2 分块”存储在“APK 签名分块”内，ID 为 0x7109871a。\n\n“APK 签名方案 v2 分块”的格式如下（所有数字值均采用小端字节序，所有带长度前缀的字段均使用 uint32 值表示长度）：\n\n- 带长度前缀的 signer（带长度前缀）序列：\n\n- - 带长度前缀的 signed data：\n\n- - - 带长度前缀的 digests（带长度前缀）序列：\n\n- - - - signature algorithm ID (uint32)\n      - （带长度前缀）digest - 请参阅[受完整性保护的内容](https://source.android.google.cn/security/apksigning/v2?hl=zh-cn#integrity-protected-contents)\n\n- - - 带长度前缀的 X.509 certificates 序列：\n\n- - - - 带长度前缀的 X.509 certificate（ASN.1 DER 格式）\n\n- - - 带长度前缀的 additional attributes（带长度前缀）序列：\n\n- - - - ID (uint32)\n      - value（可变长度：附加属性的长度 - 4 个字节）\n\n- - 带长度前缀的 signatures（带长度前缀）序列：\n\n- - - signature algorithm ID (uint32)\n    - signed data 上带长度前缀的 signature\n\n- - 带长度前缀的 public key（SubjectPublicKeyInfo，ASN.1 DER 形式）\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637292251949-a290643a-011e-4cc8-a7d6-69b58760a5de.png)\n\n**V2 摘要计算方式**\n\n第 1、3 和 4 部分的摘要采用以下计算方式，类似于两级 [Merkle 树](https://en.wikipedia.org/wiki/Merkle_tree)。每个部分都会被拆分成多个大小为 1MB（220 个字节）的连续块。每个部分的最后一个块可能会短一些。每个块的摘要均通过字节 0xa5 的串联、块的长度（采用小端字节序的 uint32 值，以字节数计）和块的内容进行计算。顶级摘要通过字节 0x5a 的串联、块数（采用小端字节序的 uint32 值）以及块的摘要的连接（按照块在 APK 中显示的顺序）进行计算。摘要以分块方式计算，以便通过并行处理来加快计算速度。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637303311648-f1c266b7-fba4-4349-b4d6-7c1c35111f21.png)\n\n**防回滚保护**\n\n攻击者可能会试图在支持对带 v2 签名的 APK 进行验证的 Android 平台上将带 v2 签名的 APK 作为带 v1 签名的 APK 进行验证。为了防范此类攻击，带 v2 签名的 APK 如果还带 v1 签名，其 META-INF/_.SF 文件的主要部分中必须包含 X-Android-APK-Signed 属性。该属性的值是一组以英文逗号分隔的 APK 签名方案 ID（v2 方案的 ID 为 2）。在验证 v1 签名时，对于此组中验证程序首选的 APK 签名方案（例如，v2 方案），如果 APK 没有相应的签名，APK 验证程序必须要拒绝这些 APK。此项保护依赖于内容 META-INF/_.SF 文件受 v1 签名保护这一事实。请参阅 JAR 已签名的 APK 的验证部分。\n\n攻击者可能会试图从“APK 签名方案 v2 分块”中删除安全系数较高的签名。为了防范此类攻击，对 APK 进行签名时使用的签名算法 ID 的列表会存储在通过各个签名保护的 signed data 分块中。\n\n**签名验证**\n\n对“APK 签名方案 v2 分块”中的每个 signer 执行以下操作：\n\n1. 从 signatures 中选择安全系数最高的受支持 signature algorithm ID。安全系数排序取决于各个实现/平台版本。\n2. 使用 public key 并对照 signed data 验证 signatures 中对应的 signature。（现在可以安全地解析 signed data 了。）\n3. 验证 digests 和 signatures 中的签名算法 ID 列表（有序列表）是否相同。（这是为了防止删除/添加签名。）\n4. 使用签名算法所用的同一种摘要算法[计算 APK 内容的摘要](https://source.android.google.cn/security/apksigning/v2?hl=zh-cn#integrity-protected-contents)。\n5. 验证计算出的摘要是否与 digests 中对应的 digest 一致。\n6. 验证 certificates 中第一个 certificate 的 SubjectPublicKeyInfo 是否与 public key 相同。\n\n## v3 签名机制\n\n为了保持与 v1 APK 格式的向后兼容性，v2 和 v3 APK 签名存储在“APK 签名分块”内紧邻 ZIP Central Directory 前面。\n\nv3 APK 签名分块的格式与 v2 相同。APK 的 v3 签名会存储为一个“ID-值”对，其中 ID 为 0xf05368c0。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637311968516-9c9164d9-03ed-48bd-a28c-f88e4a421df0.png)\n\nv3 版本签名验证证书步骤：\n\n- 利用 PublicKey 解密 Signature，得到 SignerData 的 hash 明文\n- 计算 SignerData 的 hash 值\n- 两个值进行比较，如果相同则认为 APK 没有被修改过，解析出 SignerData 中的证书。否则安装失败\n- 逐个解析出 level 块证书并验证，并保存为这个应用的历史证书\n- 如果是第一次安装，直接将证书与历史证书一并保存在应用信息中\n- 如果是更新安装，验证之前的证书与历史证书，是否与本次解析的证书或者历史证书中存在相同的证书，其中任意一个证书符合即可安装\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637312149010-e182b936-62dd-468d-bc15-24cc1afd8fdf.png)\n\n每一个 level 块的结构\n\nproof-of-rotation 存储在“APK 签名方案 v3 分块”内，ID 为 0x3ba06f8c。其格式为：\n\n带长度前缀的 levels（带长度前缀）序列：\n\n- 带长度前缀的 signed data（由上一个证书签名 - 如果存在上一个证书）\n\n- - 带长度前缀的 X.509 certificate（ASN.1 DER 形式）\n\n- - - signature algorithm ID (uint32) - 上一级证书使用的算法\n    - flags (uint32) - 这些标记用于指示此证书是否应该在 self-trusted-old-certs 结构中，以及针对哪些操作。\n\n- - signature algorithm ID (uint32) - 必须与下一级签名数据部分中的相应 ID 一致。\n  - 上述 signed data 上带长度前缀的 signature\n\n新特性场景举例\n\n其实就是当开发者需要更换证书时，即可直接用新证书新的私钥进行签名。不过为了让老应用相信新的证书，则需要用老证书来保证。举个例子，有两个 level 块：level 1 与 level 2：\n\n- level 1 放置老证书的信息\n- level 2 中放置新证书的信息以及这段数据的签名\n- level 2 中的签名是由老私钥进行签名的，则需要用老证书的公钥来验证\n- 校验原来的证书与 level 1 相同，则相信本次更新的 level 2 的证书，即签名 APK 的证书\n\n完成安装并记录新证书信息\n","source":"_posts/android-签名方案研究.md","raw":"---\ntitle: android签名详解\ndate: 2022-04-24 12:36:49\ntags: android\n---\n\n**Android 支持以下三种应用签名方案**\n\n- v1 方案：基于 JAR 签名。\n- v2 方案：[APK 签名方案 v2](https://source.android.com/security/apksigning/v2?hl=zh-cn)（在 Android 7.0 中引入），Android 11 强制要求开启 v2 签名。\n- v3 方案：[APK 签名方案 v3](https://source.android.com/security/apksigning/v3?hl=zh-cn)（在 Android 9.0 中引入）。\n\n**APK 签名验证过程**\n\n<!-- more -->\n\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637240247957-902343f6-793b-467d-88da-39cb6b79b65b.png)\n\n## v1 签名机制\n\n**v1 签名过程**\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241119998-710e5f21-ceb5-427d-9737-732fc517d842.png)\n\nandroid apk 本质上是一个 zip 文件，解压缩 apk 之后，在 META-INF 文件下下面有个 3 个文件。这 3 个文件在签名时创建，在验证时使用。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241932281-ff71b895-3437-4847-b94e-e1343a28a22b.png)\n\n1. MANIFEST.MF 文件\n\n文件内容：前面几行记录的是基础信息，后面的 key-value 对，记录 apk 中每一个文件对应的摘要信息，防止某个文件被篡改。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241496036-ae9f77f3-de63-498b-84de-c73bd76dbbe5.png)\n\n1. CERT.SF 文件\n\n文件的内容：**SHA-256-Digest-Manifest** 记录的是 **MANIFEST.MF** 的信息摘要，以及 **MANIFEST.MF** 中，每个数据块的摘要。防止 **MANIFEST.MF** 被篡改。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241675582-ba01a2ff-a958-4c1b-a1a8-8ffb83b7e12d.png)\n\n1. CERT.RSA 文件\n\n文件内容：存储了签名和公钥证书以及 SF 文件的摘要信息。\n\n```git\nopenssl pkcs7 -inform DER -in CERT.RSA -noout -print_certs -text\n```\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637289563483-c9d98b18-0e99-4a10-94b8-67a7a89aca25.png)\n\n**v1 签名存在的问题**\n\n1. **校验速度慢：**需要对 apk 中的每个文件都计算摘要并验证，如果文件很多，校验时间会很长。\n2. **完整性不够：**V1 签名只会校验 Zip 文件中的部分文件，例如 **META-INFO** 文件夹就不会参与校验。\n\n## V2 签名机制\n\n了解 zip 压缩包格式和 APK 签名之后的数据格式\n\n为了保护 APK 内容，APK 包含以下 4 个部分：\n\n- ZIP 条目的内容（从偏移量 0 处开始一直到“APK 签名分块”的起始位置）\n- APK 签名分块\n- ZIP 中央目录\n- ZIP 中央目录结尾\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637291796732-139b2e40-e3ee-4fcc-a390-1f522c09d08c.png)\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637291614626-4631c226-7cf7-462c-83f2-231beb6cd268.png)\n\n**zip 压缩包的解析过程**\n\n1. 先从文件尾部查找 0x06054b50，确定 End Of Central Directory Record 区域的起始位置；\n2. 解析 EoCDR 区域，并获得中央目录的起始位置；\n3. 根据起始位置，逐个解析文件。\n\n**V2 签名数据块的格式**\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637292066946-cb513fd0-a6d9-4877-97a4-a11f6cc69c5a.png)\n\n该分块包含多个“ID-值”对，所采用的封装方式有助于更轻松地在 APK 中找到该分块。APK 的 v2 签名会存储为一个“ID-值”对，其中 ID 为 0x7109871a 保存 apk 的签名信息。\n\n签名块的末尾是一个魔数，也就是‘APK Sig Block 42’的 ASCII 码。\n\n**签名信息的具体结构**\n\n“APK 签名方案 v2 分块”存储在“APK 签名分块”内，ID 为 0x7109871a。\n\n“APK 签名方案 v2 分块”的格式如下（所有数字值均采用小端字节序，所有带长度前缀的字段均使用 uint32 值表示长度）：\n\n- 带长度前缀的 signer（带长度前缀）序列：\n\n- - 带长度前缀的 signed data：\n\n- - - 带长度前缀的 digests（带长度前缀）序列：\n\n- - - - signature algorithm ID (uint32)\n      - （带长度前缀）digest - 请参阅[受完整性保护的内容](https://source.android.google.cn/security/apksigning/v2?hl=zh-cn#integrity-protected-contents)\n\n- - - 带长度前缀的 X.509 certificates 序列：\n\n- - - - 带长度前缀的 X.509 certificate（ASN.1 DER 格式）\n\n- - - 带长度前缀的 additional attributes（带长度前缀）序列：\n\n- - - - ID (uint32)\n      - value（可变长度：附加属性的长度 - 4 个字节）\n\n- - 带长度前缀的 signatures（带长度前缀）序列：\n\n- - - signature algorithm ID (uint32)\n    - signed data 上带长度前缀的 signature\n\n- - 带长度前缀的 public key（SubjectPublicKeyInfo，ASN.1 DER 形式）\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637292251949-a290643a-011e-4cc8-a7d6-69b58760a5de.png)\n\n**V2 摘要计算方式**\n\n第 1、3 和 4 部分的摘要采用以下计算方式，类似于两级 [Merkle 树](https://en.wikipedia.org/wiki/Merkle_tree)。每个部分都会被拆分成多个大小为 1MB（220 个字节）的连续块。每个部分的最后一个块可能会短一些。每个块的摘要均通过字节 0xa5 的串联、块的长度（采用小端字节序的 uint32 值，以字节数计）和块的内容进行计算。顶级摘要通过字节 0x5a 的串联、块数（采用小端字节序的 uint32 值）以及块的摘要的连接（按照块在 APK 中显示的顺序）进行计算。摘要以分块方式计算，以便通过并行处理来加快计算速度。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637303311648-f1c266b7-fba4-4349-b4d6-7c1c35111f21.png)\n\n**防回滚保护**\n\n攻击者可能会试图在支持对带 v2 签名的 APK 进行验证的 Android 平台上将带 v2 签名的 APK 作为带 v1 签名的 APK 进行验证。为了防范此类攻击，带 v2 签名的 APK 如果还带 v1 签名，其 META-INF/_.SF 文件的主要部分中必须包含 X-Android-APK-Signed 属性。该属性的值是一组以英文逗号分隔的 APK 签名方案 ID（v2 方案的 ID 为 2）。在验证 v1 签名时，对于此组中验证程序首选的 APK 签名方案（例如，v2 方案），如果 APK 没有相应的签名，APK 验证程序必须要拒绝这些 APK。此项保护依赖于内容 META-INF/_.SF 文件受 v1 签名保护这一事实。请参阅 JAR 已签名的 APK 的验证部分。\n\n攻击者可能会试图从“APK 签名方案 v2 分块”中删除安全系数较高的签名。为了防范此类攻击，对 APK 进行签名时使用的签名算法 ID 的列表会存储在通过各个签名保护的 signed data 分块中。\n\n**签名验证**\n\n对“APK 签名方案 v2 分块”中的每个 signer 执行以下操作：\n\n1. 从 signatures 中选择安全系数最高的受支持 signature algorithm ID。安全系数排序取决于各个实现/平台版本。\n2. 使用 public key 并对照 signed data 验证 signatures 中对应的 signature。（现在可以安全地解析 signed data 了。）\n3. 验证 digests 和 signatures 中的签名算法 ID 列表（有序列表）是否相同。（这是为了防止删除/添加签名。）\n4. 使用签名算法所用的同一种摘要算法[计算 APK 内容的摘要](https://source.android.google.cn/security/apksigning/v2?hl=zh-cn#integrity-protected-contents)。\n5. 验证计算出的摘要是否与 digests 中对应的 digest 一致。\n6. 验证 certificates 中第一个 certificate 的 SubjectPublicKeyInfo 是否与 public key 相同。\n\n## v3 签名机制\n\n为了保持与 v1 APK 格式的向后兼容性，v2 和 v3 APK 签名存储在“APK 签名分块”内紧邻 ZIP Central Directory 前面。\n\nv3 APK 签名分块的格式与 v2 相同。APK 的 v3 签名会存储为一个“ID-值”对，其中 ID 为 0xf05368c0。\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637311968516-9c9164d9-03ed-48bd-a28c-f88e4a421df0.png)\n\nv3 版本签名验证证书步骤：\n\n- 利用 PublicKey 解密 Signature，得到 SignerData 的 hash 明文\n- 计算 SignerData 的 hash 值\n- 两个值进行比较，如果相同则认为 APK 没有被修改过，解析出 SignerData 中的证书。否则安装失败\n- 逐个解析出 level 块证书并验证，并保存为这个应用的历史证书\n- 如果是第一次安装，直接将证书与历史证书一并保存在应用信息中\n- 如果是更新安装，验证之前的证书与历史证书，是否与本次解析的证书或者历史证书中存在相同的证书，其中任意一个证书符合即可安装\n\n![img](https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637312149010-e182b936-62dd-468d-bc15-24cc1afd8fdf.png)\n\n每一个 level 块的结构\n\nproof-of-rotation 存储在“APK 签名方案 v3 分块”内，ID 为 0x3ba06f8c。其格式为：\n\n带长度前缀的 levels（带长度前缀）序列：\n\n- 带长度前缀的 signed data（由上一个证书签名 - 如果存在上一个证书）\n\n- - 带长度前缀的 X.509 certificate（ASN.1 DER 形式）\n\n- - - signature algorithm ID (uint32) - 上一级证书使用的算法\n    - flags (uint32) - 这些标记用于指示此证书是否应该在 self-trusted-old-certs 结构中，以及针对哪些操作。\n\n- - signature algorithm ID (uint32) - 必须与下一级签名数据部分中的相应 ID 一致。\n  - 上述 signed data 上带长度前缀的 signature\n\n新特性场景举例\n\n其实就是当开发者需要更换证书时，即可直接用新证书新的私钥进行签名。不过为了让老应用相信新的证书，则需要用老证书来保证。举个例子，有两个 level 块：level 1 与 level 2：\n\n- level 1 放置老证书的信息\n- level 2 中放置新证书的信息以及这段数据的签名\n- level 2 中的签名是由老私钥进行签名的，则需要用老证书的公钥来验证\n- 校验原来的证书与 level 1 相同，则相信本次更新的 level 2 的证书，即签名 APK 的证书\n\n完成安装并记录新证书信息\n","slug":"android-签名方案研究","published":1,"updated":"2022-04-24T08:54:40.876Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2eqclf10000v66x7wtn1pe7","content":"<p><strong>Android 支持以下三种应用签名方案</strong></p>\n<ul>\n<li>v1 方案：基于 JAR 签名。</li>\n<li>v2 方案：<a href=\"https://source.android.com/security/apksigning/v2?hl=zh-cn\">APK 签名方案 v2</a>（在 Android 7.0 中引入），Android 11 强制要求开启 v2 签名。</li>\n<li>v3 方案：<a href=\"https://source.android.com/security/apksigning/v3?hl=zh-cn\">APK 签名方案 v3</a>（在 Android 9.0 中引入）。</li>\n</ul>\n<p><strong>APK 签名验证过程</strong></p>\n<span id=\"more\"></span>\n\n\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637240247957-902343f6-793b-467d-88da-39cb6b79b65b.png\" alt=\"img\"></p>\n<h2 id=\"v1-签名机制\"><a href=\"#v1-签名机制\" class=\"headerlink\" title=\"v1 签名机制\"></a>v1 签名机制</h2><p><strong>v1 签名过程</strong></p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241119998-710e5f21-ceb5-427d-9737-732fc517d842.png\" alt=\"img\"></p>\n<p>android apk 本质上是一个 zip 文件，解压缩 apk 之后，在 META-INF 文件下下面有个 3 个文件。这 3 个文件在签名时创建，在验证时使用。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241932281-ff71b895-3437-4847-b94e-e1343a28a22b.png\" alt=\"img\"></p>\n<ol>\n<li>MANIFEST.MF 文件</li>\n</ol>\n<p>文件内容：前面几行记录的是基础信息，后面的 key-value 对，记录 apk 中每一个文件对应的摘要信息，防止某个文件被篡改。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241496036-ae9f77f3-de63-498b-84de-c73bd76dbbe5.png\" alt=\"img\"></p>\n<ol>\n<li>CERT.SF 文件</li>\n</ol>\n<p>文件的内容：<strong>SHA-256-Digest-Manifest</strong> 记录的是 <strong>MANIFEST.MF</strong> 的信息摘要，以及 <strong>MANIFEST.MF</strong> 中，每个数据块的摘要。防止 <strong>MANIFEST.MF</strong> 被篡改。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241675582-ba01a2ff-a958-4c1b-a1a8-8ffb83b7e12d.png\" alt=\"img\"></p>\n<ol>\n<li>CERT.RSA 文件</li>\n</ol>\n<p>文件内容：存储了签名和公钥证书以及 SF 文件的摘要信息。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs7 -inform DER -in CERT.RSA -noout -print_certs -text</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637289563483-c9d98b18-0e99-4a10-94b8-67a7a89aca25.png\" alt=\"img\"></p>\n<p><strong>v1 签名存在的问题</strong></p>\n<ol>\n<li><strong>校验速度慢：</strong>需要对 apk 中的每个文件都计算摘要并验证，如果文件很多，校验时间会很长。</li>\n<li><strong>完整性不够：</strong>V1 签名只会校验 Zip 文件中的部分文件，例如 <strong>META-INFO</strong> 文件夹就不会参与校验。</li>\n</ol>\n<h2 id=\"V2-签名机制\"><a href=\"#V2-签名机制\" class=\"headerlink\" title=\"V2 签名机制\"></a>V2 签名机制</h2><p>了解 zip 压缩包格式和 APK 签名之后的数据格式</p>\n<p>为了保护 APK 内容，APK 包含以下 4 个部分：</p>\n<ul>\n<li>ZIP 条目的内容（从偏移量 0 处开始一直到“APK 签名分块”的起始位置）</li>\n<li>APK 签名分块</li>\n<li>ZIP 中央目录</li>\n<li>ZIP 中央目录结尾</li>\n</ul>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637291796732-139b2e40-e3ee-4fcc-a390-1f522c09d08c.png\" alt=\"img\"></p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637291614626-4631c226-7cf7-462c-83f2-231beb6cd268.png\" alt=\"img\"></p>\n<p><strong>zip 压缩包的解析过程</strong></p>\n<ol>\n<li>先从文件尾部查找 0x06054b50，确定 End Of Central Directory Record 区域的起始位置；</li>\n<li>解析 EoCDR 区域，并获得中央目录的起始位置；</li>\n<li>根据起始位置，逐个解析文件。</li>\n</ol>\n<p><strong>V2 签名数据块的格式</strong></p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637292066946-cb513fd0-a6d9-4877-97a4-a11f6cc69c5a.png\" alt=\"img\"></p>\n<p>该分块包含多个“ID-值”对，所采用的封装方式有助于更轻松地在 APK 中找到该分块。APK 的 v2 签名会存储为一个“ID-值”对，其中 ID 为 0x7109871a 保存 apk 的签名信息。</p>\n<p>签名块的末尾是一个魔数，也就是‘APK Sig Block 42’的 ASCII 码。</p>\n<p><strong>签名信息的具体结构</strong></p>\n<p>“APK 签名方案 v2 分块”存储在“APK 签名分块”内，ID 为 0x7109871a。</p>\n<p>“APK 签名方案 v2 分块”的格式如下（所有数字值均采用小端字节序，所有带长度前缀的字段均使用 uint32 值表示长度）：</p>\n<ul>\n<li><p>带长度前缀的 signer（带长度前缀）序列：</p>\n</li>\n<li><ul>\n<li>带长度前缀的 signed data：</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>带长度前缀的 digests（带长度前缀）序列：</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li><ul>\n<li>signature algorithm ID (uint32)</li>\n<li>（带长度前缀）digest - 请参阅<a href=\"https://source.android.google.cn/security/apksigning/v2?hl=zh-cn#integrity-protected-contents\">受完整性保护的内容</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>带长度前缀的 X.509 certificates 序列：</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li><ul>\n<li>带长度前缀的 X.509 certificate（ASN.1 DER 格式）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>带长度前缀的 additional attributes（带长度前缀）序列：</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li><ul>\n<li>ID (uint32)</li>\n<li>value（可变长度：附加属性的长度 - 4 个字节）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li>带长度前缀的 signatures（带长度前缀）序列：</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>signature algorithm ID (uint32)</li>\n<li>signed data 上带长度前缀的 signature</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li>带长度前缀的 public key（SubjectPublicKeyInfo，ASN.1 DER 形式）</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637292251949-a290643a-011e-4cc8-a7d6-69b58760a5de.png\" alt=\"img\"></p>\n<p><strong>V2 摘要计算方式</strong></p>\n<p>第 1、3 和 4 部分的摘要采用以下计算方式，类似于两级 <a href=\"https://en.wikipedia.org/wiki/Merkle_tree\">Merkle 树</a>。每个部分都会被拆分成多个大小为 1MB（220 个字节）的连续块。每个部分的最后一个块可能会短一些。每个块的摘要均通过字节 0xa5 的串联、块的长度（采用小端字节序的 uint32 值，以字节数计）和块的内容进行计算。顶级摘要通过字节 0x5a 的串联、块数（采用小端字节序的 uint32 值）以及块的摘要的连接（按照块在 APK 中显示的顺序）进行计算。摘要以分块方式计算，以便通过并行处理来加快计算速度。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637303311648-f1c266b7-fba4-4349-b4d6-7c1c35111f21.png\" alt=\"img\"></p>\n<p><strong>防回滚保护</strong></p>\n<p>攻击者可能会试图在支持对带 v2 签名的 APK 进行验证的 Android 平台上将带 v2 签名的 APK 作为带 v1 签名的 APK 进行验证。为了防范此类攻击，带 v2 签名的 APK 如果还带 v1 签名，其 META-INF&#x2F;<em>.SF 文件的主要部分中必须包含 X-Android-APK-Signed 属性。该属性的值是一组以英文逗号分隔的 APK 签名方案 ID（v2 方案的 ID 为 2）。在验证 v1 签名时，对于此组中验证程序首选的 APK 签名方案（例如，v2 方案），如果 APK 没有相应的签名，APK 验证程序必须要拒绝这些 APK。此项保护依赖于内容 META-INF&#x2F;</em>.SF 文件受 v1 签名保护这一事实。请参阅 JAR 已签名的 APK 的验证部分。</p>\n<p>攻击者可能会试图从“APK 签名方案 v2 分块”中删除安全系数较高的签名。为了防范此类攻击，对 APK 进行签名时使用的签名算法 ID 的列表会存储在通过各个签名保护的 signed data 分块中。</p>\n<p><strong>签名验证</strong></p>\n<p>对“APK 签名方案 v2 分块”中的每个 signer 执行以下操作：</p>\n<ol>\n<li>从 signatures 中选择安全系数最高的受支持 signature algorithm ID。安全系数排序取决于各个实现&#x2F;平台版本。</li>\n<li>使用 public key 并对照 signed data 验证 signatures 中对应的 signature。（现在可以安全地解析 signed data 了。）</li>\n<li>验证 digests 和 signatures 中的签名算法 ID 列表（有序列表）是否相同。（这是为了防止删除&#x2F;添加签名。）</li>\n<li>使用签名算法所用的同一种摘要算法<a href=\"https://source.android.google.cn/security/apksigning/v2?hl=zh-cn#integrity-protected-contents\">计算 APK 内容的摘要</a>。</li>\n<li>验证计算出的摘要是否与 digests 中对应的 digest 一致。</li>\n<li>验证 certificates 中第一个 certificate 的 SubjectPublicKeyInfo 是否与 public key 相同。</li>\n</ol>\n<h2 id=\"v3-签名机制\"><a href=\"#v3-签名机制\" class=\"headerlink\" title=\"v3 签名机制\"></a>v3 签名机制</h2><p>为了保持与 v1 APK 格式的向后兼容性，v2 和 v3 APK 签名存储在“APK 签名分块”内紧邻 ZIP Central Directory 前面。</p>\n<p>v3 APK 签名分块的格式与 v2 相同。APK 的 v3 签名会存储为一个“ID-值”对，其中 ID 为 0xf05368c0。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637311968516-9c9164d9-03ed-48bd-a28c-f88e4a421df0.png\" alt=\"img\"></p>\n<p>v3 版本签名验证证书步骤：</p>\n<ul>\n<li>利用 PublicKey 解密 Signature，得到 SignerData 的 hash 明文</li>\n<li>计算 SignerData 的 hash 值</li>\n<li>两个值进行比较，如果相同则认为 APK 没有被修改过，解析出 SignerData 中的证书。否则安装失败</li>\n<li>逐个解析出 level 块证书并验证，并保存为这个应用的历史证书</li>\n<li>如果是第一次安装，直接将证书与历史证书一并保存在应用信息中</li>\n<li>如果是更新安装，验证之前的证书与历史证书，是否与本次解析的证书或者历史证书中存在相同的证书，其中任意一个证书符合即可安装</li>\n</ul>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637312149010-e182b936-62dd-468d-bc15-24cc1afd8fdf.png\" alt=\"img\"></p>\n<p>每一个 level 块的结构</p>\n<p>proof-of-rotation 存储在“APK 签名方案 v3 分块”内，ID 为 0x3ba06f8c。其格式为：</p>\n<p>带长度前缀的 levels（带长度前缀）序列：</p>\n<ul>\n<li><p>带长度前缀的 signed data（由上一个证书签名 - 如果存在上一个证书）</p>\n</li>\n<li><ul>\n<li>带长度前缀的 X.509 certificate（ASN.1 DER 形式）</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>signature algorithm ID (uint32) - 上一级证书使用的算法</li>\n<li>flags (uint32) - 这些标记用于指示此证书是否应该在 self-trusted-old-certs 结构中，以及针对哪些操作。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li>signature algorithm ID (uint32) - 必须与下一级签名数据部分中的相应 ID 一致。</li>\n<li>上述 signed data 上带长度前缀的 signature</li>\n</ul>\n</li>\n</ul>\n<p>新特性场景举例</p>\n<p>其实就是当开发者需要更换证书时，即可直接用新证书新的私钥进行签名。不过为了让老应用相信新的证书，则需要用老证书来保证。举个例子，有两个 level 块：level 1 与 level 2：</p>\n<ul>\n<li>level 1 放置老证书的信息</li>\n<li>level 2 中放置新证书的信息以及这段数据的签名</li>\n<li>level 2 中的签名是由老私钥进行签名的，则需要用老证书的公钥来验证</li>\n<li>校验原来的证书与 level 1 相同，则相信本次更新的 level 2 的证书，即签名 APK 的证书</li>\n</ul>\n<p>完成安装并记录新证书信息</p>\n","site":{"data":{}},"excerpt":"<p><strong>Android 支持以下三种应用签名方案</strong></p>\n<ul>\n<li>v1 方案：基于 JAR 签名。</li>\n<li>v2 方案：<a href=\"https://source.android.com/security/apksigning/v2?hl=zh-cn\">APK 签名方案 v2</a>（在 Android 7.0 中引入），Android 11 强制要求开启 v2 签名。</li>\n<li>v3 方案：<a href=\"https://source.android.com/security/apksigning/v3?hl=zh-cn\">APK 签名方案 v3</a>（在 Android 9.0 中引入）。</li>\n</ul>\n<p><strong>APK 签名验证过程</strong></p>","more":"<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637240247957-902343f6-793b-467d-88da-39cb6b79b65b.png\" alt=\"img\"></p>\n<h2 id=\"v1-签名机制\"><a href=\"#v1-签名机制\" class=\"headerlink\" title=\"v1 签名机制\"></a>v1 签名机制</h2><p><strong>v1 签名过程</strong></p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241119998-710e5f21-ceb5-427d-9737-732fc517d842.png\" alt=\"img\"></p>\n<p>android apk 本质上是一个 zip 文件，解压缩 apk 之后，在 META-INF 文件下下面有个 3 个文件。这 3 个文件在签名时创建，在验证时使用。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241932281-ff71b895-3437-4847-b94e-e1343a28a22b.png\" alt=\"img\"></p>\n<ol>\n<li>MANIFEST.MF 文件</li>\n</ol>\n<p>文件内容：前面几行记录的是基础信息，后面的 key-value 对，记录 apk 中每一个文件对应的摘要信息，防止某个文件被篡改。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241496036-ae9f77f3-de63-498b-84de-c73bd76dbbe5.png\" alt=\"img\"></p>\n<ol>\n<li>CERT.SF 文件</li>\n</ol>\n<p>文件的内容：<strong>SHA-256-Digest-Manifest</strong> 记录的是 <strong>MANIFEST.MF</strong> 的信息摘要，以及 <strong>MANIFEST.MF</strong> 中，每个数据块的摘要。防止 <strong>MANIFEST.MF</strong> 被篡改。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637241675582-ba01a2ff-a958-4c1b-a1a8-8ffb83b7e12d.png\" alt=\"img\"></p>\n<ol>\n<li>CERT.RSA 文件</li>\n</ol>\n<p>文件内容：存储了签名和公钥证书以及 SF 文件的摘要信息。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl pkcs7 -inform DER -in CERT.RSA -noout -print_certs -text</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637289563483-c9d98b18-0e99-4a10-94b8-67a7a89aca25.png\" alt=\"img\"></p>\n<p><strong>v1 签名存在的问题</strong></p>\n<ol>\n<li><strong>校验速度慢：</strong>需要对 apk 中的每个文件都计算摘要并验证，如果文件很多，校验时间会很长。</li>\n<li><strong>完整性不够：</strong>V1 签名只会校验 Zip 文件中的部分文件，例如 <strong>META-INFO</strong> 文件夹就不会参与校验。</li>\n</ol>\n<h2 id=\"V2-签名机制\"><a href=\"#V2-签名机制\" class=\"headerlink\" title=\"V2 签名机制\"></a>V2 签名机制</h2><p>了解 zip 压缩包格式和 APK 签名之后的数据格式</p>\n<p>为了保护 APK 内容，APK 包含以下 4 个部分：</p>\n<ul>\n<li>ZIP 条目的内容（从偏移量 0 处开始一直到“APK 签名分块”的起始位置）</li>\n<li>APK 签名分块</li>\n<li>ZIP 中央目录</li>\n<li>ZIP 中央目录结尾</li>\n</ul>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637291796732-139b2e40-e3ee-4fcc-a390-1f522c09d08c.png\" alt=\"img\"></p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637291614626-4631c226-7cf7-462c-83f2-231beb6cd268.png\" alt=\"img\"></p>\n<p><strong>zip 压缩包的解析过程</strong></p>\n<ol>\n<li>先从文件尾部查找 0x06054b50，确定 End Of Central Directory Record 区域的起始位置；</li>\n<li>解析 EoCDR 区域，并获得中央目录的起始位置；</li>\n<li>根据起始位置，逐个解析文件。</li>\n</ol>\n<p><strong>V2 签名数据块的格式</strong></p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637292066946-cb513fd0-a6d9-4877-97a4-a11f6cc69c5a.png\" alt=\"img\"></p>\n<p>该分块包含多个“ID-值”对，所采用的封装方式有助于更轻松地在 APK 中找到该分块。APK 的 v2 签名会存储为一个“ID-值”对，其中 ID 为 0x7109871a 保存 apk 的签名信息。</p>\n<p>签名块的末尾是一个魔数，也就是‘APK Sig Block 42’的 ASCII 码。</p>\n<p><strong>签名信息的具体结构</strong></p>\n<p>“APK 签名方案 v2 分块”存储在“APK 签名分块”内，ID 为 0x7109871a。</p>\n<p>“APK 签名方案 v2 分块”的格式如下（所有数字值均采用小端字节序，所有带长度前缀的字段均使用 uint32 值表示长度）：</p>\n<ul>\n<li><p>带长度前缀的 signer（带长度前缀）序列：</p>\n</li>\n<li><ul>\n<li>带长度前缀的 signed data：</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>带长度前缀的 digests（带长度前缀）序列：</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li><ul>\n<li>signature algorithm ID (uint32)</li>\n<li>（带长度前缀）digest - 请参阅<a href=\"https://source.android.google.cn/security/apksigning/v2?hl=zh-cn#integrity-protected-contents\">受完整性保护的内容</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>带长度前缀的 X.509 certificates 序列：</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li><ul>\n<li>带长度前缀的 X.509 certificate（ASN.1 DER 格式）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>带长度前缀的 additional attributes（带长度前缀）序列：</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li><ul>\n<li>ID (uint32)</li>\n<li>value（可变长度：附加属性的长度 - 4 个字节）</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li>带长度前缀的 signatures（带长度前缀）序列：</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>signature algorithm ID (uint32)</li>\n<li>signed data 上带长度前缀的 signature</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li>带长度前缀的 public key（SubjectPublicKeyInfo，ASN.1 DER 形式）</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637292251949-a290643a-011e-4cc8-a7d6-69b58760a5de.png\" alt=\"img\"></p>\n<p><strong>V2 摘要计算方式</strong></p>\n<p>第 1、3 和 4 部分的摘要采用以下计算方式，类似于两级 <a href=\"https://en.wikipedia.org/wiki/Merkle_tree\">Merkle 树</a>。每个部分都会被拆分成多个大小为 1MB（220 个字节）的连续块。每个部分的最后一个块可能会短一些。每个块的摘要均通过字节 0xa5 的串联、块的长度（采用小端字节序的 uint32 值，以字节数计）和块的内容进行计算。顶级摘要通过字节 0x5a 的串联、块数（采用小端字节序的 uint32 值）以及块的摘要的连接（按照块在 APK 中显示的顺序）进行计算。摘要以分块方式计算，以便通过并行处理来加快计算速度。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637303311648-f1c266b7-fba4-4349-b4d6-7c1c35111f21.png\" alt=\"img\"></p>\n<p><strong>防回滚保护</strong></p>\n<p>攻击者可能会试图在支持对带 v2 签名的 APK 进行验证的 Android 平台上将带 v2 签名的 APK 作为带 v1 签名的 APK 进行验证。为了防范此类攻击，带 v2 签名的 APK 如果还带 v1 签名，其 META-INF&#x2F;<em>.SF 文件的主要部分中必须包含 X-Android-APK-Signed 属性。该属性的值是一组以英文逗号分隔的 APK 签名方案 ID（v2 方案的 ID 为 2）。在验证 v1 签名时，对于此组中验证程序首选的 APK 签名方案（例如，v2 方案），如果 APK 没有相应的签名，APK 验证程序必须要拒绝这些 APK。此项保护依赖于内容 META-INF&#x2F;</em>.SF 文件受 v1 签名保护这一事实。请参阅 JAR 已签名的 APK 的验证部分。</p>\n<p>攻击者可能会试图从“APK 签名方案 v2 分块”中删除安全系数较高的签名。为了防范此类攻击，对 APK 进行签名时使用的签名算法 ID 的列表会存储在通过各个签名保护的 signed data 分块中。</p>\n<p><strong>签名验证</strong></p>\n<p>对“APK 签名方案 v2 分块”中的每个 signer 执行以下操作：</p>\n<ol>\n<li>从 signatures 中选择安全系数最高的受支持 signature algorithm ID。安全系数排序取决于各个实现&#x2F;平台版本。</li>\n<li>使用 public key 并对照 signed data 验证 signatures 中对应的 signature。（现在可以安全地解析 signed data 了。）</li>\n<li>验证 digests 和 signatures 中的签名算法 ID 列表（有序列表）是否相同。（这是为了防止删除&#x2F;添加签名。）</li>\n<li>使用签名算法所用的同一种摘要算法<a href=\"https://source.android.google.cn/security/apksigning/v2?hl=zh-cn#integrity-protected-contents\">计算 APK 内容的摘要</a>。</li>\n<li>验证计算出的摘要是否与 digests 中对应的 digest 一致。</li>\n<li>验证 certificates 中第一个 certificate 的 SubjectPublicKeyInfo 是否与 public key 相同。</li>\n</ol>\n<h2 id=\"v3-签名机制\"><a href=\"#v3-签名机制\" class=\"headerlink\" title=\"v3 签名机制\"></a>v3 签名机制</h2><p>为了保持与 v1 APK 格式的向后兼容性，v2 和 v3 APK 签名存储在“APK 签名分块”内紧邻 ZIP Central Directory 前面。</p>\n<p>v3 APK 签名分块的格式与 v2 相同。APK 的 v3 签名会存储为一个“ID-值”对，其中 ID 为 0xf05368c0。</p>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637311968516-9c9164d9-03ed-48bd-a28c-f88e4a421df0.png\" alt=\"img\"></p>\n<p>v3 版本签名验证证书步骤：</p>\n<ul>\n<li>利用 PublicKey 解密 Signature，得到 SignerData 的 hash 明文</li>\n<li>计算 SignerData 的 hash 值</li>\n<li>两个值进行比较，如果相同则认为 APK 没有被修改过，解析出 SignerData 中的证书。否则安装失败</li>\n<li>逐个解析出 level 块证书并验证，并保存为这个应用的历史证书</li>\n<li>如果是第一次安装，直接将证书与历史证书一并保存在应用信息中</li>\n<li>如果是更新安装，验证之前的证书与历史证书，是否与本次解析的证书或者历史证书中存在相同的证书，其中任意一个证书符合即可安装</li>\n</ul>\n<p><img src=\"https://intranetproxy.alipay.com/skylark/lark/0/2021/png/3756563/1637312149010-e182b936-62dd-468d-bc15-24cc1afd8fdf.png\" alt=\"img\"></p>\n<p>每一个 level 块的结构</p>\n<p>proof-of-rotation 存储在“APK 签名方案 v3 分块”内，ID 为 0x3ba06f8c。其格式为：</p>\n<p>带长度前缀的 levels（带长度前缀）序列：</p>\n<ul>\n<li><p>带长度前缀的 signed data（由上一个证书签名 - 如果存在上一个证书）</p>\n</li>\n<li><ul>\n<li>带长度前缀的 X.509 certificate（ASN.1 DER 形式）</li>\n</ul>\n</li>\n<li><ul>\n<li><ul>\n<li>signature algorithm ID (uint32) - 上一级证书使用的算法</li>\n<li>flags (uint32) - 这些标记用于指示此证书是否应该在 self-trusted-old-certs 结构中，以及针对哪些操作。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><ul>\n<li>signature algorithm ID (uint32) - 必须与下一级签名数据部分中的相应 ID 一致。</li>\n<li>上述 signed data 上带长度前缀的 signature</li>\n</ul>\n</li>\n</ul>\n<p>新特性场景举例</p>\n<p>其实就是当开发者需要更换证书时，即可直接用新证书新的私钥进行签名。不过为了让老应用相信新的证书，则需要用老证书来保证。举个例子，有两个 level 块：level 1 与 level 2：</p>\n<ul>\n<li>level 1 放置老证书的信息</li>\n<li>level 2 中放置新证书的信息以及这段数据的签名</li>\n<li>level 2 中的签名是由老私钥进行签名的，则需要用老证书的公钥来验证</li>\n<li>校验原来的证书与 level 1 相同，则相信本次更新的 level 2 的证书，即签名 APK 的证书</li>\n</ul>\n<p>完成安装并记录新证书信息</p>"},{"title":"hexo","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n<!-- more -->\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: hexo\ntags: hexo\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n<!-- more -->\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2022-04-23T06:11:04.197Z","updated":"2022-04-24T11:56:47.623Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2eqclf60001v66xdntvc95y","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><span id=\"more\"></span>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3>","more":"<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>"},{"title":"虎妞","date":"2022-04-23T14:32:31.000Z","_content":"\n\n小铃铛的妈妈，经常带小铃铛干坏事。当然也教会了小铃铛很多生存技能\n\n<!-- more -->\n\n**她在看我的手**\n\n![IMG_3141](https://cdn.jsdelivr.net/gh/barryxc/pictures@main/uPic/IMG_3141.jpg)\n","source":"_posts/我的虎妞.md","raw":"---\ntitle: 虎妞\ndate: 2022-04-23 22:32:31\ntags: 宠物\n\n---\n\n\n小铃铛的妈妈，经常带小铃铛干坏事。当然也教会了小铃铛很多生存技能\n\n<!-- more -->\n\n**她在看我的手**\n\n![IMG_3141](https://cdn.jsdelivr.net/gh/barryxc/pictures@main/uPic/IMG_3141.jpg)\n","slug":"我的虎妞","published":1,"updated":"2022-04-24T08:53:26.044Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2eqclf90003v66x1scoh0hn","content":"<p>小铃铛的妈妈，经常带小铃铛干坏事。当然也教会了小铃铛很多生存技能</p>\n<span id=\"more\"></span>\n\n<p><strong>她在看我的手</strong></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/barryxc/pictures@main/uPic/IMG_3141.jpg\" alt=\"IMG_3141\"></p>\n","site":{"data":{}},"excerpt":"<p>小铃铛的妈妈，经常带小铃铛干坏事。当然也教会了小铃铛很多生存技能</p>","more":"<p><strong>她在看我的手</strong></p>\n<p><img src=\"https://cdn.jsdelivr.net/gh/barryxc/pictures@main/uPic/IMG_3141.jpg\" alt=\"IMG_3141\"></p>"},{"title":"铃铛","date":"2022-04-23T14:32:31.000Z","_content":"\n小铃铛每天出门都很怂，出门的时候就不敢下来。\n\n回到家的时候，就是它的主场，每天白天不起，晚上床头蹦迪。\n\n<!-- more -->\n\n\n![IMG_3190](https://cdn.jsdelivr.net/gh/barryxc/pictures@main/uPic/IMG_3190.jpeg)\n","source":"_posts/我的铃铛.md","raw":"---\ntitle: 铃铛\ndate: 2022-04-23 22:32:31\ntags: 宠物\n\n---\n\n小铃铛每天出门都很怂，出门的时候就不敢下来。\n\n回到家的时候，就是它的主场，每天白天不起，晚上床头蹦迪。\n\n<!-- more -->\n\n\n![IMG_3190](https://cdn.jsdelivr.net/gh/barryxc/pictures@main/uPic/IMG_3190.jpeg)\n","slug":"我的铃铛","published":1,"updated":"2022-04-24T08:55:58.751Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl2eqclfa0004v66xdtga4vyq","content":"<p>小铃铛每天出门都很怂，出门的时候就不敢下来。</p>\n<p>回到家的时候，就是它的主场，每天白天不起，晚上床头蹦迪。</p>\n<span id=\"more\"></span>\n\n\n<p><img src=\"https://cdn.jsdelivr.net/gh/barryxc/pictures@main/uPic/IMG_3190.jpeg\" alt=\"IMG_3190\"></p>\n","site":{"data":{}},"excerpt":"<p>小铃铛每天出门都很怂，出门的时候就不敢下来。</p>\n<p>回到家的时候，就是它的主场，每天白天不起，晚上床头蹦迪。</p>","more":"<p><img src=\"https://cdn.jsdelivr.net/gh/barryxc/pictures@main/uPic/IMG_3190.jpeg\" alt=\"IMG_3190\"></p>"},{"title":"hexo 博客搭建教程","date":"2022-04-25T13:53:20.000Z","_content":"\n[TOC]\n\n## 运行环境\n\nnode\n\ngit\n\n## 搭建步骤\n\n安装 hexo\n\n通过 github 免费建站\n\n## 高级功能\n\ntypora + upic 建立图床\n\nVscode 代码编辑器\n\n自定义 landscape 主题\n\nvaline + leancloud 实现无后端评论系统\n\n购买阿里云域名实现域名转发\n\n实现打赏功能\n\n## 踩坑\n\n国内实现 url 显示和隐式转发需要备案\n\n域名转发导致 css 样式失效\n\n\n\n\n\n\n\n\n\n\n\n","source":"_posts/hexo-博客搭建教程.md","raw":"---\ntitle: hexo 博客搭建教程\ncategory: '教程'\ndate: 2022-04-25 21:53:20\ntags: hexo\n---\n\n[TOC]\n\n## 运行环境\n\nnode\n\ngit\n\n## 搭建步骤\n\n安装 hexo\n\n通过 github 免费建站\n\n## 高级功能\n\ntypora + upic 建立图床\n\nVscode 代码编辑器\n\n自定义 landscape 主题\n\nvaline + leancloud 实现无后端评论系统\n\n购买阿里云域名实现域名转发\n\n实现打赏功能\n\n## 踩坑\n\n国内实现 url 显示和隐式转发需要备案\n\n域名转发导致 css 样式失效\n\n\n\n\n\n\n\n\n\n\n\n","slug":"hexo-博客搭建教程","published":1,"updated":"2022-04-25T14:26:54.906Z","_id":"cl2es5n0400002n6xbdp8havg","comments":1,"layout":"post","photos":[],"link":"","content":"<p>[TOC]</p>\n<h2 id=\"运行环境\"><a href=\"#运行环境\" class=\"headerlink\" title=\"运行环境\"></a>运行环境</h2><p>node</p>\n<p>git</p>\n<h2 id=\"搭建步骤\"><a href=\"#搭建步骤\" class=\"headerlink\" title=\"搭建步骤\"></a>搭建步骤</h2><p>安装 hexo</p>\n<p>通过 github 免费建站</p>\n<h2 id=\"高级功能\"><a href=\"#高级功能\" class=\"headerlink\" title=\"高级功能\"></a>高级功能</h2><p>typora + upic 建立图床</p>\n<p>Vscode 代码编辑器</p>\n<p>自定义 landscape 主题</p>\n<p>valine + leancloud 实现无后端评论系统</p>\n<p>购买阿里云域名实现域名转发</p>\n<p>实现打赏功能</p>\n<h2 id=\"踩坑\"><a href=\"#踩坑\" class=\"headerlink\" title=\"踩坑\"></a>踩坑</h2><p>国内实现 url 显示和隐式转发需要备案</p>\n<p>域名转发导致 css 样式失效</p>\n","site":{"data":{}},"excerpt":"","more":"<p>[TOC]</p>\n<h2 id=\"运行环境\"><a href=\"#运行环境\" class=\"headerlink\" title=\"运行环境\"></a>运行环境</h2><p>node</p>\n<p>git</p>\n<h2 id=\"搭建步骤\"><a href=\"#搭建步骤\" class=\"headerlink\" title=\"搭建步骤\"></a>搭建步骤</h2><p>安装 hexo</p>\n<p>通过 github 免费建站</p>\n<h2 id=\"高级功能\"><a href=\"#高级功能\" class=\"headerlink\" title=\"高级功能\"></a>高级功能</h2><p>typora + upic 建立图床</p>\n<p>Vscode 代码编辑器</p>\n<p>自定义 landscape 主题</p>\n<p>valine + leancloud 实现无后端评论系统</p>\n<p>购买阿里云域名实现域名转发</p>\n<p>实现打赏功能</p>\n<h2 id=\"踩坑\"><a href=\"#踩坑\" class=\"headerlink\" title=\"踩坑\"></a>踩坑</h2><p>国内实现 url 显示和隐式转发需要备案</p>\n<p>域名转发导致 css 样式失效</p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl2es5n0400002n6xbdp8havg","category_id":"cl2et50kg0000ml6xhb6qf59q","_id":"cl2et5gc30007ml6xeiauhfh6"}],"PostTag":[{"post_id":"cl2eqclf10000v66x7wtn1pe7","tag_id":"cl2eqclf80002v66x3v7c1mj7","_id":"cl2eqclfc0006v66xbvmo1a87"},{"post_id":"cl2eqclf60001v66xdntvc95y","tag_id":"cl2eqclfb0005v66x0dci6j69","_id":"cl2eqclfc0008v66xf9di48gy"},{"post_id":"cl2eqclf90003v66x1scoh0hn","tag_id":"cl2eqclfc0007v66x591kdiar","_id":"cl2eqclfe000av66x1tlkhnzz"},{"post_id":"cl2eqclfa0004v66xdtga4vyq","tag_id":"cl2eqclfc0007v66x591kdiar","_id":"cl2eqclfe000bv66xbmkq31mo"},{"post_id":"cl2es5n0400002n6xbdp8havg","tag_id":"cl2eqclfb0005v66x0dci6j69","_id":"cl2et5gc20006ml6x4vu01g0c"}],"Tag":[{"name":"android","_id":"cl2eqclf80002v66x3v7c1mj7"},{"name":"hexo","_id":"cl2eqclfb0005v66x0dci6j69"},{"name":"宠物","_id":"cl2eqclfc0007v66x591kdiar"},{"name":"教程","_id":"cl2et5cub0004ml6x9038dn8k"}]}}